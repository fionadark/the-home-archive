spring:
  # H2 Database Configuration for Development
  datasource:
    url: jdbc:h2:mem:homearchive_dev;DB_CLOSE_DELAY=-1;DB_CLOSE_ON_EXIT=FALSE
    username: sa
    password: 
    driver-class-name: org.h2.Driver
    hikari:
      connection-timeout: 20000
      maximum-pool-size: 10
      minimum-idle: 5
      idle-timeout: 300000
      leak-detection-threshold: 60000
  
  # H2 Console (for development debugging)
  h2:
    console:
      enabled: true
      path: /h2-console
      settings:
        web-allow-others: false
  
  # JPA/Hibernate Configuration
  jpa:
    database-platform: org.hibernate.dialect.H2Dialect
    hibernate:
      ddl-auto: create-drop
      format_sql: true
      naming:
        physical-strategy: org.hibernate.boot.model.naming.CamelCaseToUnderscoresNamingStrategy
    show-sql: true
    properties:
      hibernate:
        jdbc:
          batch_size: 20
        order_inserts: true
        order_updates: true
        format_sql: true
    defer-datasource-initialization: true
  
  # SQL Initialization
  sql:
    init:
      mode: always
      data-locations: classpath:data.sql
      encoding: utf-8
  
  # Flyway Configuration
  flyway:
    enabled: false # Disable for H2 development, use ddl-auto instead
    
  # Mail Configuration (using embedded mail server for development)
  mail:
    host: localhost
    port: 1025
    username: 
    password: 
    properties:
      mail:
        smtp:
          auth: false
          starttls:
            enable: false
        debug: true

# Application Configuration
server:
  port: 8080
  servlet:
    context-path: /api
  error:
    include-message: always
    include-binding-errors: always

# JWT Configuration
jwt:
  secret: dev-secret-key-change-in-production-this-must-be-at-least-256-bits
  expiration: 86400000 # 24 hours
  refresh-expiration: 604800000 # 7 days

# External APIs Configuration
external:
  api:
    open-library:
      base-url: https://openlibrary.org
      timeout: 5000

# Resilience4j Configuration
resilience4j:
  circuitbreaker:
    instances:
      open-library:
        failure-rate-threshold: 60
        wait-duration-in-open-state: 20000
        sliding-window-size: 8
  retry:
    instances:
      external-api:
        max-attempts: 3
        wait-duration: 1000

# Logging Configuration
logging:
  level:
    com.thehomearchive.library: DEBUG
    org.springframework.security: DEBUG
    org.springframework.web: DEBUG
    org.hibernate.SQL: DEBUG
    org.hibernate.type.descriptor.sql.BasicBinder: TRACE
  pattern:
    file: "%d{yyyy-MM-dd HH:mm:ss} [%thread] %-5level %logger{36} - %msg%n"
    console: "%d{HH:mm:ss.SSS} [%thread] %-5level %logger{36} - %msg%n"
  logback:
    rollingpolicy:
      max-file-size: 10MB
      max-history: 3
      total-size-cap: 50MB
      clean-history-on-start: true

# Management/Actuator Configuration
management:
  endpoints:
    web:
      exposure:
        include: health,info,metrics,env,loggers,configprops,mappings,beans,auditevents
      base-path: /actuator
  endpoint:
    health:
      show-details: always
      show-components: always
    metrics:
      enabled: true
    info:
      enabled: true
    loggers:
      enabled: true
  info:
    env:
      enabled: true
    java:
      enabled: true
    os:
      enabled: true
  metrics:
    export:
      simple:
        enabled: true
    web:
      server:
        request:
          autotime:
            enabled: true
            percentiles: 0.5,0.95,0.99
    tags:
      application: ${spring.application.name:the-home-archive}
      environment: development

# Monitoring Configuration
monitoring:
  enable-request-logging: true
  slow-request-threshold: 2000