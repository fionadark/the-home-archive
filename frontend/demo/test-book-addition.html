<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Book Addition - Test</title>
    <link rel="stylesheet" href="../src/css/components/search-results.css">
    <style>
        /* Basic Dark Academia styling for testing */
        .dark-academia {
            background-color: #2c1810;
            color: #f5f5dc;
            font-family: 'Times New Roman', serif;
            padding: 20px;
            min-height: 100vh;
        }

        .book-addition-container {
            max-width: 800px;
            margin: 0 auto;
            background-color: #3d2817;
            padding: 30px;
            border-radius: 8px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.3);
        }

        .step-progress {
            display: flex;
            justify-content: center;
            margin-bottom: 30px;
        }

        .step {
            padding: 10px 20px;
            margin: 0 10px;
            background-color: #5a3e2b;
            border-radius: 4px;
            color: #d4af8c;
        }

        .step.active {
            background-color: #8b6f47;
            color: #fff;
        }

        .step.completed {
            background-color: #4a5d23;
            color: #c9d93a;
        }

        .section {
            display: none;
        }

        .section.active {
            display: block;
        }

        .elegant-form {
            background-color: #4a3526;
            padding: 20px;
            border-radius: 6px;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-row {
            display: flex;
            gap: 20px;
        }

        .form-row .form-group {
            flex: 1;
        }

        label {
            display: block;
            margin-bottom: 5px;
            color: #d4af8c;
            font-weight: bold;
        }

        input, select, textarea {
            width: 100%;
            padding: 10px;
            border: 1px solid #6b4e37;
            border-radius: 4px;
            background-color: #5a3e2b;
            color: #f5f5dc;
            font-size: 14px;
        }

        input:focus, select:focus, textarea:focus {
            outline: none;
            border-color: #8b6f47;
            box-shadow: 0 0 5px rgba(139, 111, 71, 0.5);
        }

        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 4px;
            font-size: 14px;
            cursor: pointer;
            margin-right: 10px;
            transition: background-color 0.3s;
        }

        .btn-primary {
            background-color: #8b6f47;
            color: white;
        }

        .btn-primary:hover {
            background-color: #9b7f57;
        }

        .btn-secondary {
            background-color: #6b4e37;
            color: #d4af8c;
        }

        .btn-secondary:hover {
            background-color: #7b5e47;
        }

        .form-actions {
            margin-top: 20px;
            text-align: center;
        }

        .book-preview {
            display: flex;
            gap: 20px;
            margin: 20px 0;
            padding: 20px;
            background-color: #3d2817;
            border-radius: 6px;
        }

        .book-cover {
            width: 120px;
            flex-shrink: 0;
        }

        .book-cover img {
            width: 100%;
            height: auto;
            border-radius: 4px;
        }

        .cover-placeholder {
            width: 120px;
            height: 160px;
            background-color: #5a3e2b;
            border: 2px dashed #8b6f47;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #d4af8c;
            font-size: 12px;
            text-align: center;
            border-radius: 4px;
        }

        .book-details h5 {
            margin: 0 0 10px 0;
            color: #f5f5dc;
            font-size: 18px;
        }

        .book-details p {
            margin: 5px 0;
            color: #d4af8c;
            font-size: 14px;
        }

        .validation-errors {
            margin: 15px 0;
        }

        .error-list {
            background-color: #4a2c2c;
            border-left: 4px solid #d32f2f;
            padding: 15px;
            border-radius: 4px;
        }

        .error-list h5 {
            margin: 0 0 10px 0;
            color: #ffcdd2;
        }

        .error-list ul {
            margin: 0;
            padding-left: 20px;
        }

        .error-list li {
            color: #ffcdd2;
            margin: 5px 0;
        }

        .isbn-validation-success, .book-exists-warning {
            background-color: #2e5d2e;
            border-left: 4px solid #4caf50;
            padding: 15px;
            border-radius: 4px;
            margin: 15px 0;
        }

        .book-exists-warning {
            background-color: #5d4e2e;
            border-left-color: #ff9800;
        }

        .isbn-validation-error {
            background-color: #4a2c2c;
            border-left: 4px solid #d32f2f;
            padding: 15px;
            border-radius: 4px;
            margin: 15px 0;
            color: #ffcdd2;
        }

        .book-confirmation-preview {
            display: flex;
            gap: 20px;
            margin: 20px 0;
            padding: 20px;
            background-color: #3d2817;
            border-radius: 6px;
        }

        .confirmation-cover {
            width: 150px;
            flex-shrink: 0;
        }

        .confirmation-cover img {
            width: 100%;
            height: auto;
            border-radius: 4px;
        }

        .confirmation-details h4 {
            margin: 0 0 10px 0;
            color: #f5f5dc;
            font-size: 24px;
        }

        .confirmation-details p {
            margin: 8px 0;
            color: #d4af8c;
            font-size: 16px;
        }

        .sr-only {
            position: absolute;
            width: 1px;
            height: 1px;
            padding: 0;
            margin: -1px;
            overflow: hidden;
            clip: rect(0, 0, 0, 0);
            white-space: nowrap;
            border: 0;
        }

        small {
            color: #a0a0a0;
            font-size: 12px;
        }

        .cover-preview {
            margin-top: 10px;
        }

        .cover-preview img {
            max-width: 150px;
            max-height: 200px;
            border-radius: 4px;
        }
    </style>
</head>
<body>
    <div id="book-addition-container" class="dark-academia">
        <h1>Book Addition Test</h1>
        <div id="book-addition-mount"></div>
    </div>

    <!-- Mock services for testing -->
    <script type="module">
        // Mock NotificationService
        class NotificationService {
            showSuccess(message) {
                alert(`SUCCESS: ${message}`);
                console.log('SUCCESS:', message);
            }

            showError(message) {
                alert(`ERROR: ${message}`);
                console.error('ERROR:', message);
            }
        }

        // Mock BookService  
        class BookService {
            async validateBookByIsbn(isbn) {
                console.log('Validating ISBN:', isbn);
                
                // Simulate API delay
                await new Promise(resolve => setTimeout(resolve, 1000));
                
                // Mock responses for demo
                if (isbn === '9780743273565' || isbn === '978-0-7432-7356-5') {
                    return {
                        valid: true,
                        isbn: isbn,
                        title: 'The Great Gatsby',
                        author: 'F. Scott Fitzgerald',
                        publisher: 'Scribner',
                        publicationYear: 1925,
                        pageCount: 180,
                        description: 'A classic American novel about the Jazz Age',
                        coverImageUrl: 'https://covers.openlibrary.org/b/isbn/9780743273565-M.jpg',
                        existsInDatabase: false,
                        enrichedFromExternalSource: true,
                        externalSource: 'Open Library'
                    };
                } else if (isbn === '9780451524935') {
                    return {
                        valid: true,
                        isbn: isbn,
                        title: '1984',
                        author: 'George Orwell',
                        existsInDatabase: true,
                        bookId: 1
                    };
                } else if (isbn.length < 10) {
                    return {
                        valid: false,
                        isbn: isbn,
                        errorMessage: 'Invalid ISBN format'
                    };
                } else {
                    return {
                        valid: true,
                        isbn: isbn,
                        title: 'Unknown Book',
                        author: 'Unknown Author',
                        existsInDatabase: false,
                        enrichedFromExternalSource: false
                    };
                }
            }

            async createBook(bookData) {
                console.log('Creating book:', bookData);
                
                // Simulate API delay
                await new Promise(resolve => setTimeout(resolve, 800));
                
                return {
                    id: Math.floor(Math.random() * 1000) + 1,
                    ...bookData,
                    createdAt: new Date().toISOString()
                };
            }

            async addBookToLibrary(bookId) {
                console.log('Adding book to library:', bookId);
                
                // Simulate API delay
                await new Promise(resolve => setTimeout(resolve, 500));
                
                return {
                    success: true,
                    message: 'Book added to library'
                };
            }

            async getCategories() {
                console.log('Getting categories');
                
                // Simulate API delay
                await new Promise(resolve => setTimeout(resolve, 300));
                
                return [
                    { id: 1, name: 'Fiction' },
                    { id: 2, name: 'Non-Fiction' },
                    { id: 3, name: 'Science Fiction' },
                    { id: 4, name: 'Biography' },
                    { id: 5, name: 'History' },
                    { id: 6, name: 'Philosophy' }
                ];
            }

            getAuthToken() {
                return 'mock-auth-token';
            }
        }

        // Override the imports for our mocks
        window.mockBookService = BookService;
        window.mockNotificationService = NotificationService;
    </script>

    <script type="module">
        // Import and initialize BookAddition component
        import BookAddition from '../src/js/components/BookAddition.js';

        // Override imports with mocks
        BookAddition.prototype.bookService = new window.mockBookService();
        BookAddition.prototype.notificationService = new window.mockNotificationService();

        // Initialize component
        const bookAddition = new BookAddition();
        const container = document.getElementById('book-addition-mount');
        bookAddition.render(container);

        console.log('BookAddition component initialized');
        
        // Test instructions
        console.log(`
Test Instructions:
1. Try ISBN: 9780743273565 (The Great Gatsby - should show book data)
2. Try ISBN: 9780451524935 (1984 - should show "already in database")
3. Try invalid ISBN: 123 (should show error)
4. Try manual entry with all fields
5. Test the step progression through the form
        `);
    </script>
</body>
</html>